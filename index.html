<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to Sound Communication</title>
</head>
<body>
  <textarea id="textInput" placeholder="Enter text to transmit"></textarea>
  <button onclick="transmit()">Transmit</button>
  <div id="receiver"></div>

  <script>
    function transmit() {
      var text = document.getElementById('textInput').value;
      var encoded = textToSignal(text);
      playSound(encoded);
    }

    function textToSignal(text) {
      // Convert text to a signal
      return text.split('').map(char => char.charCodeAt(0));
    }

    function playSound(signal) {
      var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      var oscillator = audioCtx.createOscillator();
      var gainNode = audioCtx.createGain();
      oscillator.type = 'sine';
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      
      var time = 0.1; // Duration of each signal unit (in seconds)
      var frequencyMultiplier = 100;
      
      signal.forEach(code => {
        oscillator.frequency.setValueAtTime(code * frequencyMultiplier, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(1, audioCtx.currentTime);
        audioCtx.currentTime += time;
      });

      oscillator.start();
      oscillator.stop(audioCtx.currentTime + time * signal.length);
    }

    // Receiver side (decoding)
    var receiverDiv = document.getElementById('receiver');
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    var dataArray = new Uint8Array(analyser.frequencyBinCount);
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(function(stream) {
        var source = audioCtx.createMediaStreamSource(stream);
        source.connect(analyser);
        setInterval(function(){
          analyser.getByteFrequencyData(dataArray);
          // Process received signal (dataArray) to decode
          var decodedText = signalToText(dataArray);
          receiverDiv.innerHTML = decodedText;
        }, 100);
      })
      .catch(function(err) {
        console.log('The following error occurred: ' + err);
      });

    function signalToText(signal) {
      // Convert the received signal back into text
      var text = '';
      signal.forEach(value => {
        var charCode = Math.round(value / 100);
        if (charCode >= 32 && charCode <= 126) {
          text += String.fromCharCode(charCode);
        }
      });
      return text;
    }
  </script>
</body>
</html>
